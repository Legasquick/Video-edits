<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–∫ –∫ –≤–∏–¥–µ–æ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .content { padding: 30px; }
        .project-name-container, .video-player-container { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #e9ecef; }
        .edit-form { background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 2px solid #e9ecef; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #495057; font-size: 14px; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; transition: all 0.3s; font-family: inherit; }
        input:focus, textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); padding-left: 11px; border-left-width: 3px; }
        .input-error { border-color: #dc3545 !important; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important; }
        textarea { resize: vertical; min-height: 80px; }
        .toggle-container { background-color: #e9ecef; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; cursor: pointer; }
        .toggle-container input { width: auto; margin-right: 10px; }
        .toggle-container label { margin-bottom: 0; font-weight: normal; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-export { background: #17a2b8; color: white; }
        .btn-export:hover { background: #138496; }
        .btn-danger { background: #dc3545; color: white; padding: 8px 16px; font-size: 12px; }
        .btn-danger:hover { background: #c82333; }
        .btn-info { background: #17a2b8; color: white; padding: 8px 16px; font-size: 12px; }
        .btn-info:hover { background: #138496; }
        .input-with-button { display: flex; align-items: center; gap: 8px; }
        .btn-copy-time { padding: 10px 12px; border: none; background: #e9ecef; color: #495057; border-radius: 8px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
        .btn-copy-time:hover { background: #dee2e6; }
        .edits-list { margin-top: 30px; }
        .edit-item { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e9ecef; transition: all 0.3s; position: relative; }
        .edit-item:hover { border-color: #667eea; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1); }
        .edit-item.editing { border-color: #28a745; box-shadow: 0 0 10px rgba(40, 167, 69, 0.2); }
        .edit-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .edit-item-header .buttons { display: flex; gap: 8px; }
        .edit-number { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 14px; }
        .edit-item.general-edit .edit-number { background: #6c757d; }
        .edit-content { font-size: 14px; color: #495057; line-height: 1.6; }
        .edit-content strong { color: #212529; }
        .button-group { margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .main-form-buttons { display: flex; gap: 10px; align-items: center; }
        .empty-state { text-align: center; padding: 40px; color: #6c757d; }
        .empty-state-icon { font-size: 48px; margin-bottom: 15px; }
        .type-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .type-option { padding: 15px; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s; background: white; }
        .type-option:hover { border-color: #667eea; background: #f8f9ff; }
        .type-option.active { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .type-option-title { font-weight: 600; margin-bottom: 5px; }
        .type-option-desc { font-size: 12px; opacity: 0.8; }
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } .button-group { flex-direction: column; } }
        .instructions-toggle { background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .instructions-toggle:hover { background: #dee2e6; }
        .instructions-content { display: none; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px; font-size: 14px; line-height: 1.8; }
        .instructions-content.show { display: block; }
        .instructions-content h3 { color: #667eea; margin-top: 15px; margin-bottom: 10px; }
        .instructions-content ul { margin-left: 20px; }
        .instructions-content li { margin-bottom: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìπ –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–∫ –∫ –≤–∏–¥–µ–æ</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∫–∏ –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –º–æ–Ω—Ç–∞–∂–∞</p>
        </div>

        <div class="content">
            <div class="instructions-toggle" onclick="toggleInstructions()">
                <strong>üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–∞–≤–∫–∞–º–∏</strong>
                <span id="toggle-icon">‚ñº</span>
            </div>
            <div class="instructions-content" id="instructions"></div>

            <div class="project-name-container">
                <div class="form-group">
                    <label for="projectName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input type="text" id="projectName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, '–†–æ–ª–∏–∫ –¥–ª—è YouTube #5'">
                </div>
            </div>

            <div class="video-player-container">
                <div class="form-group">
                    <label for="videoUpload">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏</label>
                    <input type="file" id="videoUpload" accept="video/*" style="padding: 10px; width: 100%;">
                </div>
                <video id="videoPlayer" controls width="100%" style="border-radius: 12px; margin-top: 10px; display: none; background: #000;"></video>
            </div>

            <div class="edit-form">
                <div class="type-selector">
                    <div class="type-option active" onclick="selectType('cut')" data-type="cut">
                        <div class="type-option-title">‚úÇÔ∏è –í—ã—Ä–µ–∑–∞—Ç—å</div>
                        <div class="type-option-desc">–£–¥–∞–ª–∏—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç</div>
                    </div>
                    <div class="type-option" onclick="selectType('other')" data-type="other">
                        <div class="type-option-title">‚öôÔ∏è –î—Ä—É–≥–æ–µ</div>
                        <div class="type-option-desc">–ó–≤—É–∫, —Ü–≤–µ—Ç –∏ —Ç.–¥.</div>
                    </div>
                    <div class="type-option" onclick="selectType('general')" data-type="general">
                        <div class="type-option-title">üìÑ –û–±—â–∞—è</div>
                        <div class="type-option-desc">–ö–æ –≤—Å–µ–º—É –≤–∏–¥–µ–æ</div>
                    </div>
                </div>

                <div class="toggle-container" id="no-end-timecode-toggle" style="display: none;">
                    <input type="checkbox" id="noEndTimecode" onchange="toggleTimeEndField()">
                    <label for="noEndTimecode">–ë–µ–∑ –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ç–∞–π–º–∫–æ–¥–∞ (–ø—Ä–∞–≤–∫–∞ –≤ –æ–¥–Ω–æ–π —Ç–æ—á–∫–µ)</label>
                </div>
                
                <div class="form-row" id="timecodeRow">
                    <div class="form-group">
                        <label for="timeStart">–¢–∞–π–º–∫–æ–¥ –Ω–∞—á–∞–ª–∞ ((–ß:)–ú–ú:–°–°)</label>
                         <div class="input-with-button">
                            <input type="text" id="timeStart" placeholder="1:23:45 –∏–ª–∏ 23:45" onblur="formatTimecode(this)" onfocus="this.classList.remove('input-error')">
                            <button class="btn-copy-time" onclick="copyTimestamp('timeStart')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤–∏–¥–µ–æ">üìã</button>
                        </div>
                    </div>
                    <div class="form-group" id="timeEndGroup">
                        <label for="timeEnd">–¢–∞–π–º–∫–æ–¥ –∫–æ–Ω—Ü–∞ ((–ß:)–ú–ú:–°–°)</label>
                        <div class="input-with-button">
                            <input type="text" id="timeEnd" placeholder="1:23:55 –∏–ª–∏ 23:55" onblur="formatTimecode(this)" onfocus="this.classList.remove('input-error')">
                            <button class="btn-copy-time" onclick="copyTimestamp('timeEnd')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤–∏–¥–µ–æ">üìã</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="firstWordsGroup">
                    <label for="firstWords" id="firstWordsLabel">–ü–µ—Ä–≤—ã–µ —Ç—Ä–∏ —Å–ª–æ–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞</label>
                    <input type="text" id="firstWords" placeholder="–°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º">
                </div>
                <div class="form-group" id="lastWordsGroup">
                    <label for="lastWords">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ —Å–ª–æ–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞</label>
                    <input type="text" id="lastWords" placeholder="–æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç">
                </div>
                
                <div class="form-group">
                    <label for="action" id="actionLabel">–ß—Ç–æ –¥–µ–ª–∞–µ–º (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∫–∏)</label>
                    <textarea id="action" placeholder="–í—ã—Ä–µ–∑–∞—Ç—å"></textarea>
                </div>
                <div class="main-form-buttons">
                    <button class="btn btn-primary" id="addEditBtn" onclick="addOrUpdateEdit()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∫—É</button>
                    <button class="btn btn-secondary" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <div class="edits-list" id="editsList"></div>

            <div class="button-group" id="actionButtons" style="display: none;">
                <button class="btn btn-success" onclick="copyToClipboard()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-export" onclick="exportToSrt()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ .SRT</button>
                <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
            </div>
        </div>
    </div>

    <script>
        let edits = [];
        let currentType = 'cut';
        let currentlyEditingId = null;
        const PROJECT_STORAGE_KEY = 'videoEditorProject';

        document.addEventListener('DOMContentLoaded', () => {
            loadProject();
            selectType(currentType); 
            setupEnterNavigation();
            setupVideoPlayer();
            document.getElementById('projectName').addEventListener('input', saveProject);
            
            document.getElementById('instructions').innerHTML = `
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∫–∏ –¥–ª—è –≤–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂–∞.</p>
                <h3>‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
                <ul>
                    <li><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π –≤–∏–¥–µ–æ—Ñ–∞–π–ª, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ª–µ–≥–∫–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–º–∫–æ–¥—ã.</li>
                    <li><strong>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∫–æ–¥–æ–≤:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É üìã —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç–∞–π–º–∫–æ–¥ –∏–∑ –ø–ª–µ–µ—Ä–∞.</li>
                </ul>
                <h3>üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –ø–æ–ª–µ–∑–Ω—ã–µ —Ç—Ä—é–∫–∏</h3>
                <ul>
                    <li><strong>–£–º–Ω—ã–π –≤–≤–æ–¥ —Ç–∞–π–º–∫–æ–¥–∞:</strong> –í–∞–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏—è. –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã, –∏ —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –∏—Ö —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç:
                        <ul>
                            <li><code>123</code> ‚Üí <code>00:01:23</code></li>
                            <li><code>12345</code> ‚Üí <code>01:23:45</code></li>
                        </ul>
                    </li>
                    <li><strong>–ù–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Enter:</strong> –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–ª–∞–≤–∏—à—É <code>Enter</code> –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–ª—é. –ù–∞–∂–∞—Ç–∏–µ <code>Enter</code> –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø–æ–ª–µ "–ß—Ç–æ –¥–µ–ª–∞–µ–º" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –ø—Ä–∞–≤–∫—É.</li>
                </ul>
                <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ –¢–∏–ø–æ–≤ –ü—Ä–∞–≤–æ–∫</h3>
                <ul>
                    <li><strong>‚úÇÔ∏è –í—ã—Ä–µ–∑–∞—Ç—å:</strong> –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞. –¢—Ä–µ–±—É–µ—Ç –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞.</li>
                    <li><strong>‚öôÔ∏è –î—Ä—É–≥–æ–µ:</strong> –î–ª—è –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (–∑–≤—É–∫, —Ü–≤–µ—Ç, —ç—Ñ—Ñ–µ–∫—Ç—ã).
                        <ul>
                            <li><strong>–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:</strong> –¢—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞—Ç—å –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞.</li>
                            <li><strong>–†–µ–∂–∏–º "–ë–µ–∑ –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ç–∞–π–º–∫–æ–¥–∞":</strong> –ü—Ä–∞–≤–∫–∞ –¥–ª—è –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ª—è –∫–æ–Ω—Ü–∞ –∏—Å—á–µ–∑–∞—é—Ç, –∞ "–ü–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞" —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏.</li>
                        </ul>
                    </li>
                    <li><strong>üìÑ –û–±—â–∞—è:</strong> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–æ –≤—Å–µ–º—É –≤–∏–¥–µ–æ. –ù–µ —Ç—Ä–µ–±—É—é—Ç —Ç–∞–π–º–∫–æ–¥–æ–≤ –∏ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–≤–µ—Ä—Ö—É —Å–ø–∏—Å–∫–∞.</li>
                </ul>
                <h3>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
                <p>–í—Å—è –≤–∞—à–∞ —Ä–∞–±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –ø–æ–∑–∂–µ.</p>
            `;
        });
        
        function setupVideoPlayer() {
            document.getElementById('videoUpload').addEventListener('change', function(event) {
                const videoPlayer = document.getElementById('videoPlayer');
                const file = event.target.files[0];
                if (file) {
                    const fileURL = URL.createObjectURL(file);
                    videoPlayer.src = fileURL;
                    videoPlayer.style.display = 'block';
                }
            });
        }

        function copyTimestamp(targetId) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!videoPlayer || !videoPlayer.src) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ.');
                return;
            }
            const currentTime = Math.floor(videoPlayer.currentTime);
            const formattedTime = secondsToTimecode(currentTime);
            const targetInput = document.getElementById(targetId);
            targetInput.value = formattedTime;
            targetInput.focus();
        }

        function saveProject() { const projectData = { projectName: document.getElementById('projectName').value, edits: edits }; localStorage.setItem(PROJECT_STORAGE_KEY, JSON.stringify(projectData)); };
        function loadProject() { const savedData = localStorage.getItem(PROJECT_STORAGE_KEY); if (savedData) { const projectData = JSON.parse(savedData); edits = projectData.edits || []; document.getElementById('projectName').value = projectData.projectName || ''; renderEdits(); } };
        const fieldOrder = ['timeStart', 'timeEnd', 'firstWords', 'lastWords', 'action'];
        function handleEnterNavigation(event) { if (event.key === 'Enter') { if (event.target.tagName === 'TEXTAREA' && event.shiftKey) { return; } event.preventDefault(); if (event.target.id === 'action') { addOrUpdateEdit(); return; } const isNoEndTime = document.getElementById('noEndTimecode').checked; const currentId = event.target.id; let currentIndex = fieldOrder.indexOf(currentId); if (isNoEndTime && currentId === 'timeStart') { currentIndex = fieldOrder.indexOf('firstWords'); } else { currentIndex++; } const nextId = fieldOrder[currentIndex]; const nextElement = document.getElementById(nextId); if (nextElement) { nextElement.focus(); } } };
        function setupEnterNavigation() { fieldOrder.forEach(fieldId => { const el = document.getElementById(fieldId); if(el) el.addEventListener('keydown', handleEnterNavigation); }); };
        function toggleInstructions() { const instructions = document.getElementById('instructions'); const icon = document.getElementById('toggle-icon'); instructions.classList.toggle('show'); icon.textContent = instructions.classList.contains('show') ? '‚ñ≤' : '‚ñº'; };
        function deleteEdit(id) { if(currentlyEditingId === id) cancelEdit(); edits = edits.filter(edit => edit.id !== id); saveProject(); renderEdits(); };
        function clearAll() { if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞?')) { edits = []; document.getElementById('projectName').value = ''; saveProject(); renderEdits(); cancelEdit(); } };

        function parseAndFormatTimecode(value) {
            if (!value) return '';
            const hasColons = String(value).includes(':');
            let h = '00', m = '00', s = '00';

            if (hasColons) {
                const parts = String(value).split(':').map(p => p.padStart(2, '0'));
                if (parts.length === 3) [h, m, s] = parts;
                else if (parts.length === 2) [m, s] = parts;
            } else {
                const clean = String(value).replace(/[^\d]/g, '');
                if (clean.length <= 2) {
                    s = clean.padStart(2, '0');
                } else if (clean.length <= 4) {
                    m = clean.slice(0, -2).padStart(2, '0');
                    s = clean.slice(-2).padStart(2, '0');
                } else {
                    const padded = clean.padStart(6, '0');
                    h = padded.slice(0, -4).padStart(2, '0');
                    m = padded.slice(-4, -2).padStart(2, '0');
                    s = padded.slice(-2).padStart(2, '0');
                }
            }
            return `${h}:${m}:${s}`;
        }

        function formatTimecode(input) {
            if (input.value) {
                input.value = parseAndFormatTimecode(input.value);
            }
        }

        function timecodeToSeconds(timecode) {
            if (!timecode || !timecode.includes(':')) return 0;
            const [h, m, s] = timecode.split(':').map(Number);
            return (h * 3600) + (m * 60) + s;
        }
        
        function secondsToTimecode(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            const pad = (num) => String(num).padStart(2, '0');
            return `${pad(h)}:${pad(m)}:${pad(s)}`;
        }

        function isValidTimecode(timecode) {
            if (!timecode) return false;
            const parts = timecode.split(':');
            if (parts.length !== 3) return false;
            const [h, m, s] = parts.map(Number);
            return !(isNaN(h) || isNaN(m) || isNaN(s) || m > 59 || s > 59);
        }

        function validateAllTimecodes() {
            const startInput = document.getElementById('timeStart');
            const endInput = document.getElementById('timeEnd');
            formatTimecode(startInput); 
            formatTimecode(endInput);

            const isNoEndTime = document.getElementById('noEndTimecode').checked;
            let hasError = false;
            
            if (startInput.value && !isValidTimecode(startInput.value)) { hasError = true; } 
            if (!isNoEndTime && endInput.value && !isValidTimecode(endInput.value)) { hasError = true; }

            if (startInput.value && endInput.value && !isNoEndTime) {
                if (timecodeToSeconds(startInput.value) > timecodeToSeconds(endInput.value)) {
                    alert('–û—à–∏–±–∫–∞! –ù–∞—á–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∫–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω–µ—á–Ω–æ–≥–æ.');
                    startInput.classList.add('input-error');
                    endInput.classList.add('input-error');
                    return false;
                }
            }
            
            startInput.classList.toggle('input-error', !!(startInput.value && !isValidTimecode(startInput.value)));
            endInput.classList.toggle('input-error', !!(!isNoEndTime && endInput.value && !isValidTimecode(endInput.value)));

            return !hasError;
        }
        
        function selectType(type) {
            currentType = type;
            document.querySelectorAll('.type-option').forEach(option => option.classList.remove('active'));
            document.querySelector(`[data-type="${type}"]`).classList.add('active');

            const elements = {
                actionField: document.getElementById('action'),
                actionLabel: document.getElementById('actionLabel'),
                noEndTimeToggle: document.getElementById('no-end-timecode-toggle'),
                timecodeRow: document.getElementById('timecodeRow'),
                firstWordsGroup: document.getElementById('firstWordsGroup'),
                lastWordsGroup: document.getElementById('lastWordsGroup')
            };

            // Reset to default visibility first
            elements.timecodeRow.style.display = 'grid';
            elements.firstWordsGroup.style.display = 'block';
            elements.lastWordsGroup.style.display = 'block';
            elements.noEndTimeToggle.style.display = 'none';
            document.getElementById('noEndTimecode').checked = false;
            
            if (type === 'cut') {
                elements.actionField.placeholder = '–í—ã—Ä–µ–∑–∞—Ç—å';
                elements.actionLabel.innerHTML = '–ß—Ç–æ –¥–µ–ª–∞–µ–º (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∫–∏) <span style="color: #6c757d; font-weight: normal;">(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "–í—ã—Ä–µ–∑–∞—Ç—å")</span>';
            } else if (type === 'other') {
                elements.noEndTimeToggle.style.display = 'flex';
                elements.actionField.placeholder = '–°–¥–µ–ª–∞—Ç—å –∑–≤—É–∫ –≥—Ä–æ–º—á–µ';
                elements.actionLabel.innerHTML = '–ß—Ç–æ –¥–µ–ª–∞–µ–º (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∫–∏)';
            } else if (type === 'general') {
                elements.timecodeRow.style.display = 'none';
                elements.firstWordsGroup.style.display = 'none';
                elements.lastWordsGroup.style.display = 'none';
                elements.actionField.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: —É–≤–µ–ª–∏—á–∏—Ç—å –æ–±—â—É—é –≥—Ä–æ–º–∫–æ—Å—Ç—å';
                elements.actionLabel.innerHTML = '–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—â–µ–π –ø—Ä–∞–≤–∫–∏';
            }
            
            // Only call the toggle for fields that are not general
            if (type !== 'general') {
                toggleTimeEndField();
            }
        }
        
        function toggleTimeEndField() {
            const isChecked = document.getElementById('noEndTimecode').checked;
            document.getElementById('timeEndGroup').style.display = isChecked ? 'none' : 'block';
            document.getElementById('lastWordsGroup').style.display = isChecked ? 'none' : 'block';
            document.getElementById('firstWordsLabel').innerHTML = isChecked 
                ? '–ü–µ—Ä–≤—ã–µ —Ç—Ä–∏ —Å–ª–æ–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ <span style="color: #6c757d; font-weight: normal;">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>'
                : '–ü–µ—Ä–≤—ã–µ —Ç—Ä–∏ —Å–ª–æ–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞';
        }

        function toggleEditMode(isEditing) {
            const addBtn = document.getElementById('addEditBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            addBtn.textContent = isEditing ? 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∫—É' : '‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∫—É';
            addBtn.classList.toggle('btn-primary', !isEditing);
            addBtn.classList.toggle('btn-success', isEditing);
            cancelBtn.style.display = isEditing ? 'inline-block' : 'none';
            currentlyEditingId = isEditing ? currentlyEditingId : null;
        }

        function cancelEdit() {
            clearForm();
            renderEdits();
        }

        function editEdit(id) {
            const editData = edits.find(e => e.id === id);
            if (!editData) return;

            currentlyEditingId = id;
            const type = editData.isGeneral ? 'general' : (editData.type || 'cut');
            selectType(type);

            document.getElementById('action').value = editData.action;

            if (!editData.isGeneral) {
                document.getElementById('timeStart').value = editData.timeStart || '';
                document.getElementById('firstWords').value = editData.firstWords || '';
                
                const noEndTimeCheckbox = document.getElementById('noEndTimecode');
                noEndTimeCheckbox.checked = editData.isDurationBased;
                toggleTimeEndField();

                if (!editData.isDurationBased) {
                    document.getElementById('timeEnd').value = editData.timeEnd || '';
                    document.getElementById('lastWords').value = editData.lastWords || '';
                }
            }
            
            toggleEditMode(true);
            renderEdits();
            document.querySelector('.edit-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function addOrUpdateEdit() {
            if (currentlyEditingId !== null) saveEdit();
            else addEdit();
        }

        function getFormData() {
            let action = document.getElementById('action').value.trim();
            if (!action && currentType === 'cut') action = '–í—ã—Ä–µ–∑–∞—Ç—å';
            else if (!action) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∫–∏.'); return null; }

            if (currentType === 'general') {
                return { action, isGeneral: true, type: 'general' };
            }

            if (!validateAllTimecodes()) return null;

            const isNoEndTime = document.getElementById('noEndTimecode').checked;
            const timeStart = document.getElementById('timeStart').value.trim();
            const firstWords = document.getElementById('firstWords').value.trim();
            const timeEnd = isNoEndTime ? '' : document.getElementById('timeEnd').value.trim();
            const lastWords = isNoEndTime ? '' : document.getElementById('lastWords').value.trim();

            if (!timeStart) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–∞–π–º–∫–æ–¥ –Ω–∞—á–∞–ª–∞.'); return null; }
            if (!isNoEndTime && !timeEnd) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–∞–π–º–∫–æ–¥ –∫–æ–Ω—Ü–∞.'); return null; }
            
            return { timeStart, timeEnd, firstWords, lastWords, action, isDurationBased: isNoEndTime, isGeneral: false, type: currentType };
        }

        function addEdit() {
            const data = getFormData();
            if (data === null) return;
            edits.push({ id: Date.now(), ...data });
            saveProject();
            renderEdits();
            clearForm();
        }

        function saveEdit() {
            const data = getFormData();
            if (data === null) return;
            const editIndex = edits.findIndex(e => e.id === currentlyEditingId);
            if (editIndex > -1) {
                edits[editIndex] = { ...edits[editIndex], ...data };
            }
            saveProject();
            renderEdits();
            clearForm();
        }

        function clearForm() {
            ['timeStart', 'timeEnd', 'firstWords', 'lastWords', 'action'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            selectType('cut');
            toggleEditMode(false);
            document.getElementById('timeStart').focus();
        }
        
        function renderEdits() { 
            const listContainer = document.getElementById('editsList');
            const actionButtons = document.getElementById('actionButtons'); 
            if (edits.length === 0) { 
                listContainer.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üìù</div><p>–ü—Ä–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.</p></div>`; 
                actionButtons.style.display = 'none'; 
                return; 
            } 
            actionButtons.style.display = 'flex'; 
            const generalEdits = edits.filter(e => e.isGeneral); 
            const timedEdits = edits.filter(e => !e.isGeneral).sort((a, b) => timecodeToSeconds(a.timeStart) - timecodeToSeconds(b.timeStart)); 
            const generalHtml = generalEdits.map(edit => `
                <div class="edit-item ${edit.id === currentlyEditingId ? 'editing' : ''} general-edit">
                    <div class="edit-item-header">
                        <span class="edit-number">–û–±—â–∞—è –ø—Ä–∞–≤–∫–∞</span>
                        <div class="buttons">
                            <button class="btn btn-info" onclick="editEdit(${edit.id})">–ü—Ä–∞–≤–∏—Ç—å</button>
                            <button class="btn btn-danger" onclick="deleteEdit(${edit.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <div class="edit-content">${edit.action}</div>
                </div>`).join(''); 
            const timedHtml = timedEdits.map((edit, index) => { 
                const timeDisplay = edit.isDurationBased ? `${edit.timeStart}` : `${edit.timeStart} - ${edit.timeEnd}`;
                const wordsDisplay = `${edit.firstWords || ''}${edit.lastWords ? ' | ' + edit.lastWords : ''}`; 
                return `
                <div class="edit-item ${edit.id === currentlyEditingId ? 'editing' : ''}">
                    <div class="edit-item-header">
                        <span class="edit-number">–ü—Ä–∞–≤–∫–∞ ${index + 1}</span>
                         <div class="buttons">
                            <button class="btn btn-info" onclick="editEdit(${edit.id})">–ü—Ä–∞–≤–∏—Ç—å</button>
                            <button class="btn btn-danger" onclick="deleteEdit(${edit.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <div class="edit-content"><strong>${timeDisplay}</strong>${wordsDisplay ? ' | ' + wordsDisplay : ''} | ${edit.action}</div>
                </div>`; 
            }).join(''); 
            listContainer.innerHTML = generalHtml + timedHtml; 
        };
        
        function copyToClipboard() { 
            if (edits.length === 0) return; 
            const projectName = document.getElementById('projectName').value.trim(); 
            let header = projectName ? `–ü—Ä–æ–µ–∫—Ç: ${projectName}\n\n` : ''; 
            const generalEdits = edits.filter(e => e.isGeneral); 
            const timedEdits = edits.filter(e => !e.isGeneral).sort((a, b) => timecodeToSeconds(a.timeStart) - timecodeToSeconds(b.timeStart)); 
            let timedText = timedEdits.map((edit, index) => { 
                const timeDisplay = edit.isDurationBased ? `${edit.timeStart}` : `${edit.timeStart} - ${edit.timeEnd}`;
                const wordsDisplay = `${edit.firstWords ? edit.firstWords : ''}${edit.lastWords ? ' | ' + edit.lastWords : ''}`; 
                return `${index + 1}. ${timeDisplay}${wordsDisplay ? ' | ' + wordsDisplay : ''} | ${edit.action}` 
            }).join('\n\n'); 
            let generalText = ''; 
            if (generalEdits.length > 0) { 
                generalText = '\n\n---\n–û–ë–©–ò–ï –ü–†–ê–í–ö–ò:\n' + generalEdits.map(e => `- ${e.action}`).join('\n'); 
            } 
            navigator.clipboard.writeText(header + timedText + generalText).then(() => alert('‚úÖ –ü—Ä–∞–≤–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!')); 
        };

        function exportToSrt() { 
            if (edits.length === 0) { alert('–ù–µ—Ç –ø—Ä–∞–≤–æ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.'); return; } 
            const toSrtTime = (hms) => `${hms},000`; 
            const generalEdits = edits.filter(e => e.isGeneral); 
            const timedEdits = edits.filter(e => !e.isGeneral).sort((a, b) => timecodeToSeconds(a.timeStart) - timecodeToSeconds(b.timeStart)); 
            let lastTimeInSeconds = 0; 
            let currentIndex = 1; 
            let srtContent = timedEdits.map(edit => { 
                const srtStartTime = toSrtTime(edit.timeStart); 
                let srtEndTime; let endSeconds; 
                if (edit.isDurationBased) { endSeconds = timecodeToSeconds(edit.timeStart) + 2; } 
                else { endSeconds = timecodeToSeconds(edit.timeEnd); } 
                srtEndTime = toSrtTime(secondsToTimecode(endSeconds)); 
                if (endSeconds > lastTimeInSeconds) lastTimeInSeconds = endSeconds; 
                let textLines = [`[${edit.action}]`]; 
                if(edit.firstWords) textLines.push(`–ù–∞—á–∞–ª–æ: ${edit.firstWords}`);
                if (edit.lastWords) textLines.push(`–ö–æ–Ω–µ—Ü: ${edit.lastWords}`); 
                return `${currentIndex++}\n${srtStartTime} --> ${srtEndTime}\n${textLines.join('\n')}`; 
            }).join('\n\n'); 
            if (generalEdits.length > 0) { 
                if(srtContent) srtContent += '\n\n'; 
                srtContent += generalEdits.map(edit => { 
                    const startTime = lastTimeInSeconds + 2; 
                    const endTime = startTime + 1; 
                    lastTimeInSeconds = endTime; 
                    const srtStartTime = toSrtTime(secondsToTimecode(startTime)); 
                    const srtEndTime = toSrtTime(secondsToTimecode(endTime)); 
                    return `${currentIndex++}\n${srtStartTime} --> ${srtEndTime}\n[–û–ë–©–ê–Ø –ü–†–ê–í–ö–ê]: ${edit.action}`; 
                }).join('\n\n'); 
            } 
            const projectName = document.getElementById('projectName').value.trim(); 
            const fileName = (projectName.replace(/[\s/\\?%*:|"<>]/g, '_') || 'edits') + '.srt'; 
            const blob = new Blob([srtContent], { type: 'text/plain;charset=utf-8' }); 
            const link = document.createElement('a'); 
            link.href = URL.createObjectURL(blob); 
            link.download = fileName; 
            document.body.appendChild(link); 
            link.click(); 
            document.body.removeChild(link); 
            URL.revokeObjectURL(link.href); 
        };
    </script>
</body>
</html>
